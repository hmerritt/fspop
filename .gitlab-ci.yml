image: golang:1.16.3

stages:
 - test
# - build
# - release

before_script:
  - go mod download
  - make bootstrap
  - apt-get update -y
  - apt-get install zip -y
  - chmod 770 ./scripts/build.sh

build:
  stage: test
  script:
    - make build
    - ls -R pkg

release:
  stage: test
  script:
    - ./scripts/build.sh
    #${CI_COMMIT_TAG}
    - 'curl --header "JOB-TOKEN: $CI_JOB_TOKEN" --upload-file bin/linux_amd64.zip "${CI_API_V4_URL}/projects/${CI_PROJECT_ID}/packages/generic/fspop/0.4.5/linux_amd64.zip"'
    - 'curl --header "JOB-TOKEN: $CI_JOB_TOKEN" --upload-file bin/linux_arm64.zip "${CI_API_V4_URL}/projects/${CI_PROJECT_ID}/packages/generic/fspop/0.4.5/linux_arm64.zip"'
    - 'curl --header "JOB-TOKEN: $CI_JOB_TOKEN" --upload-file bin/windows_amd64.zip "${CI_API_V4_URL}/projects/${CI_PROJECT_ID}/packages/generic/fspop/0.4.5/windows_amd64.zip"'
#  only:
#    - tags
#    refs:
#      - master
